<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: auditd
  
    &mdash; Documentation by YARD 0.9.14
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::auditd";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (a)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">auditd</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: auditd</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/init.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Auditd</p>

<p>Setup and manage auditd using Puppet</p>

<p>This module takes a non-templated approach to management in order to easily
incorporate upstream changes from vendor.</p>

<p>You may control:  * Overall auditd settings in auditd.conf  * audispd
settings in audispd.conf  * Auditd rules (as managed files under
/etc/audit/rules.d)  * Purging of non-managed rules (default behaviour)</p>

  </div>
</div>


<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Install auditd, manage service and create rules</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_auditd'>auditd</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data for auditd.conf settings</p>
</div></p>
      
      <pre class="example code"><code>audit::settings:
  log_format: &quot;ENRICHED&quot;
  max_log_file: &quot;50&quot;
  num_logs: &quot;5&quot;
  max_log_file_action: &quot;rotate&quot;
  local_events: &quot;yes&quot;</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data for audispd.conf settings</p>
</div></p>
      
      <pre class="example code"><code>audit::audispd_settings:
  overflow_action: syslog
  priority_boost: 4</code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data for custom auditd rules</p>
</div></p>
      
      <pre class="example code"><code>audit::rules:
  10_date_and_time:
    content: |
      # data and time
      -a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change
      -a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change
      -a always,exit -F arch=b64 -S clock_settime -k time-change
      -a always,exit -F arch=b32 -S clock_settime -k time-change
      -w /etc/localtime -p wa -k time-change
  20_user_and_groups:
    content: |
      # users and groups
      -w /etc/group -p wa -k identity
      -w /etc/passwd -p wa -k identity
      -w /etc/gshadow -p wa -k identity
      -w /etc/shadow -p wa -k identity</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>package_name</span>
      
      
        <span class='type'>(<tt>Array[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[&quot;audit&quot;, &quot;audispd-plugins&quot;]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of the audit packages to install</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>settings</span>
      
      
        <span class='type'>(<tt>Hash[String, Any]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash of settings for the main auditd.conf config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>audispd_settings</span>
      
      
        <span class='type'>(<tt>Hash[String, Any]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash of settings for the audispd.conf config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_ensure</span>
      
      
        <span class='type'>(<tt>Enum['running','stopped']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;running&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Ensure the audit service to this state</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_enable</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> to start audit service on boot otherwise false</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>config_file</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/audit/auditd.conf&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Full path to main auditd.conf config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>audispd_config_file</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;/etc/audisp/audispd.conf&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Full path to audispd.conf config file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rules</span>
      
      
        <span class='type'>(<tt>Hash[String, Hash[String, String]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Hash of audit rules to enforce</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;auditd&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Name of audit service to manage</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>purge_rules</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p><code>true</code> to remove all non-puppet managed rules from
<code>conf_d</code> directory</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>header</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;# managed by puppet&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Warning message to add to top of each managed file</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>conf_d</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/etc/audit/rules.d/&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>directory to store rule fragments in</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_stop</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/usr/sbin/service stop auditd&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Command to stop auditd (MUST bypass systemd <a
href="https://access.redhat.com/solutions/2664811">access.redhat.com/solutions/2664811</a>)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>service_restart</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;/usr/sbin/service restart auditd&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Command to restart auditd (MUST bypass systemd <a
href="https://access.redhat.com/solutions/2664811">access.redhat.com/solutions/2664811</a>)</p>
</div>
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/init.pp', line 62</span>

class auditd(
    Array[String]                       $package_name         = [&quot;audit&quot;, &quot;audispd-plugins&quot;],
    Hash[String, Any]                   $settings             = {},
    Hash[String, Any]                   $audispd_settings     = {},
    Enum[&#39;running&#39;,&#39;stopped&#39;]           $service_ensure       = &#39;running&#39;,
    Boolean                             $service_enable       = true,
    String                              $config_file          = &#39;/etc/audit/auditd.conf&#39;,
    String                              $audispd_config_file  = &#39;/etc/audisp/audispd.conf&#39;,
    Hash[String, Hash[String, String]]  $rules                = {},
    String                              $service_name         = &quot;auditd&quot;,
    Boolean                             $purge_rules          = true,
    String                              $header               = &quot;# managed by puppet&quot;,
    String                              $conf_d               = &quot;/etc/audit/rules.d/&quot;,
    String                              $service_stop         = &quot;/usr/sbin/service stop auditd&quot;,
    String                              $service_restart      = &quot;/usr/sbin/service restart auditd&quot;,
) {

  # Install package
  package { $package_name:
    ensure =&gt; &#39;present&#39;,
  }

  # Configure required config files
  file { [$config_file, $audispd_config_file]:
    ensure =&gt; &#39;file&#39;,
    owner  =&gt; &#39;root&#39;,
    group  =&gt; &#39;root&#39;,
    mode   =&gt; &#39;0640&#39;,
  }

  fm_prepend { $config_file:
    ensure =&gt; present,
    data   =&gt; $header
  }

  $settings.each |$key, $value| {
    fm_replace { &quot;${config_file}:${key}&quot;:
      ensure            =&gt; present,
      path              =&gt; $config_file,
      data              =&gt; &quot;${key} = ${value}&quot;,
      match             =&gt; &quot;^\s*${key}\s*=&quot;,
      insert_if_missing =&gt; true,
      insert_at         =&gt; &#39;bottom&#39;,
      notify            =&gt; Service[$service_name],
    }
  }

  $audispd_settings.each |$key, $value| {
    fm_replace { &quot;${audispd_config_file}:${key}&quot;:
      ensure            =&gt; present,
      path              =&gt; $audispd_config_file,
      data              =&gt; &quot;${key} = ${value}&quot;,
      match             =&gt; &quot;^\s*${key}\s*=&quot;,
      insert_if_missing =&gt; true,
      insert_at         =&gt; &#39;bottom&#39;,
      notify            =&gt; Service[$service_name],
    }
  }

  if $purge_rules{
    file { &#39;/etc/audit/rules.d&#39;:
      ensure  =&gt; &#39;directory&#39;,
      owner   =&gt; &#39;root&#39;,
      group   =&gt; &#39;root&#39;,
      mode    =&gt; &#39;0750&#39;,
      recurse =&gt; true,
      purge   =&gt; true,
    }
  }

  $rules.each |$rule_group_name, $opts| {
    file { &quot;${conf_d}/${rule_group_name}.rules&quot;:
      ensure  =&gt; &#39;file&#39;,
      owner   =&gt; &#39;root&#39;,
      group   =&gt; &#39;root&#39;,
      mode    =&gt; &#39;0640&#39;,
      content =&gt; &quot;${header}\n${opts[&#39;content&#39;]}&quot;,
      notify  =&gt; Service[$service_name],
    }
  }

  service { $service_name:
    ensure  =&gt; $service_ensure,
    enable  =&gt; $service_enable,
    restart =&gt; $service_restart,
    stop    =&gt; $service_stop,
  }

}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>